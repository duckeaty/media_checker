该脚本可以检测指定目录下的所有视频文件是否有损坏，损坏文件会输出到文本清单（其中错误1表示不能打开，错误2表示抓图失败）。

支持中断后继续检测，不用从头开始。




原理：

先测试能否正常打开，然后每5%抓取帧图，如果正常，表示通过测试。

为了兼容性（部分好的文件也不是每帧能抓取），每个抓取点取附近5帧，有1帧能抓取即通过测试，连首帧总共21个检测点。

起因：因为阵列损坏，找回后有数据破坏，但10万+的视频文件没法手工查找，也试过一些工具，都是先测试打开，再验证开始部分，不准确（损坏位置不确定）。而用ffmpeg完整验证时间太长。结合之前做抓帧工具时的一些使用经验，采用间隔抓帧的方式来验证视频损坏。基本能保证通过验证的视频是正确的。如果有更严格的要求，可以手动更改脚本里的间隔。目前使用下来速度和准确度还不错，16个小时验证了5200个视频，查出损坏视频420个。包含之前手工随机手动进度条认为完好的视频也检测出某部分有损坏。没有做时长验证，因为我的有些视频本来就有这个问题懒得去修复，如果有严格需要自己加上吧。




使用：

python media_checker.py /path/to/videos

参数说明：

/path/to/videos：要检测的视频目录

检测结果会保存在当前目录的crashed_YYYYMMDD-HHMMSS.txt文件中

高级参数：

--output	--output my_check	自定义输出文件名前缀

--resume	--resume	从上次中断处继续检测

示例：

python media_checker.py /mnt/videos --output server_check --resume




环境需求：

Python3.6+版本

需要opencv库（安装：pip install opencv-python）
